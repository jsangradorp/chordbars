% package chordbars
% S. Kramm - 2017
% see https://github.com/skramm/chordbars

\NeedsTeXFormat{LaTeX2e}
\ProvidesPackage{chordbars}[2017/11/28 version 0.1]

\RequirePackage{tikz}
\usetikzlibrary{math,shapes}

\RequirePackage{calc}
\RequirePackage{ifthen}

% maketitle definition
%\makeatletter
%\def\@maketitle{%
%  \vskip 2em%
%  \begin{center}%
%  	\begin{tikzpicture}[line width=1pt]
%  	\tikzset{%
%  	  bignode/.style     = {font=\fontsize{20}{22.4}\selectfont}
%  	 }
%	\tikzstyle{block} = [rectangle, draw, text width=15em, text centered, minimum height=4em]
%      	\node [block,bignode,font=\bfseries] (init) { \@title~-~\@author };
%  	\end{tikzpicture}
%  \end{center}%
%  \par
%  \vskip 1.5em}
%\makeatother

\newcommand{\songtitle}
{
  \begin{center}%
  	\begin{tikzpicture}[line width=1.5pt]
	\tikzstyle{block} = [rectangle, draw, text width=20em, text centered, minimum height=4em]
      	\node [block,font=\fontsize{20}{28}\selectfont\bfseries] (init) { \@title~-~\@author };
  	\end{tikzpicture}
  \end{center}%
  \par
  \vskip 1.5em
}


\newcounter{NumMesure}
\newcounter{NumPart}
\newcounter{CurrentBar}

\newcommand{\resetchordbars}
{
	\setcounter{NumMesure}{0}
	\setcounter{NumPart}{0}
	\setcounter{CurrentBar}{0}
}
%
% arg 1: number of bars (4, 8, ...)
% arg 2: nb of repeats
% arg 3: part name
\newenvironment{chordbar}[3]
{
	\def\barsize{1.6}%	
	\setcounter{CurrentBar}{0}
%
	\newcommand{\chordf}[1]
	{ %
		\refstepcounter{CurrentBar}%
		\draw (-\barsize/2+\theCurrentBar*\barsize,\barsize/2) node {##1};%
	}%
%
	\newcommand{\chordh}[2]
	{ %
		\ifthenelse{\equal{##2}{1}}
		{
			\refstepcounter{CurrentBar}%
			\draw (-3*\barsize/4+\theCurrentBar*\barsize,3*\barsize/4) node {##1};
		}
		{
			\draw (-\barsize/4+\theCurrentBar*\barsize,1*\barsize/4) node {##1};%	
		}
		\draw (\barsize*\theCurrentBar-\barsize,0) -- (\theCurrentBar*\barsize,\barsize);		
%		\draw (-\barsize/2+\theCurrentBar*\barsize,\barsize/2) node {##1};%
	}%
%
% Draw full bar chord
	\newcommand{\chordfn}[2]
	{ %
		\draw (-\barsize/2+##1*\barsize,\barsize/2) node {##2};%
	}%
%
% Draw half bar chord
	\newcommand{\chordhn}[3]
	{ %
		\ifthenelse{\equal{##3}{1}}
		{ %
			\draw (-3*\barsize/4+##1*\barsize,3*\barsize/4) node {##2};%
		} %
		{ %
			\draw (-\barsize/4+##1*\barsize,1*\barsize/4) node {##2};%		
		} %
%		\draw [line width=1pt] (\barsize*##1-\barsize,0) -- (##1*\barsize,\barsize);
		\draw (\barsize*##1-\barsize,0) -- (##1*\barsize,\barsize);
	}%
%
	\fontfamily{phv}\selectfont
%
	\refstepcounter{NumPart}%
	\refstepcounter{NumMesure}%
	\noindent\ignorespaces %
	\begin{tikzpicture}[line width=1pt]
	\draw (0,\barsize*1.1) node [anchor=west, align=left] {Part \theNumPart: #3}; % title
	\draw (0,0) -- (0,\barsize);
	\draw (0,0) -- (#1*\barsize,0);
	\draw (0,\barsize) -- (#1*\barsize,\barsize);
	\draw (\barsize-\barsize/2,-.2) node{\theNumMesure};	
	\foreach \k in {1,...,#1}
	{
		\draw (\k*\barsize,0) -- (\k*\barsize,\barsize);
	};
	\setcounter{NumMesure}{#1*#2+\value{NumMesure}-1}
	\draw (#1*\barsize+1,0.5) node {x~#2};
}%
{
	\end{tikzpicture}
	\par\noindent%
	\ignorespacesafterend	
}


\endinput
  
